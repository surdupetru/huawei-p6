
//add for zme coef config by l50053, begin
#include <mach/hisi_mem.h> 
//add for zme coef config by l50053, end
#include "vpp_inter.h"

#define LOG_TAG "VPP_INTER"
#include "vpp_log.h"

#define VPP_RESERVED_MEM_ADDR  hisi_reserved_vpp_phymem //S00198515 add for DIE 20120828
#define VPP_RESERVED_BASE_SIZE HISI_MEM_VPP_SIZE

#define DIE_FRAME_MAX_WIDTH (1920)  //S00198515 add for DIE 20120828
#define DIE_FRAME_MAX_HEIGHT (1088)  //S00198515 add for DIE 20120828
/**************************************************************
全局变量定义
*/

//VPP 通道:0 vsd, 1 vhd
static VPP_VPP_S s_stVPPLayer[HAL_LAYER_BUTT];

//VPP ZME 系数
static VPP_ZOOM_COEF_ADDR_S s_stZoomCoef;

//VPP DIE //S00198515 add 20120823
static VPP_DIE_ADDR_S s_stDieAddr;

//VPP DIE addr ctrl
static unsigned int s_u32DieAddrCtrl[10];

//add for zme coef config by l50053, begin
int coefficient4_cubic[18][4] = {{0, 511,0,0}, {-19, 511,  21,	-1}, {-37, 509,  42,  -2}, {-51, 504,  64,-5},
                        {-64, 499,  86,  -9}, {-74, 492, 108, -14}, {-82, 484, 129, -19}, {-89, 474, 152,-25}, {-94, 463,174, -31},
                        {-97, 451, 196, -38}, {-98, 438, 217, -45}, {-98, 424, 238, -52}, {-98, 409, 260,-59}, {-95, 392,280, -65},
                        {-92, 376, 300, -72}, {-88, 358, 320, -78}, {-83, 339, 339, -83}, {  0,   0,	0,   0}};

int coefficient4_1M[18][4] = {{151, 150, 151,  60}, {149, 149, 150,  64}, {147, 148, 150,  67},
                        {145, 147, 149,  71}, {143, 146, 148,  75}, {141, 145, 148,  78}, {139, 144, 147,82}, {137, 144, 146,85},
                        {134, 143, 146,  89}, {132, 143, 145,  92}, {130, 143, 145,  94}, {127, 143, 144,98}, {125, 142, 144,101},
                        {122, 142, 143, 105}, {119, 142, 143, 108}, {117, 142, 143, 110}, {114, 142, 142,114}, { 0,0,0,0}};

int coefficient4_2M[18][4] = {{148, 171, 148, 45}, {145, 170, 149, 48}, {142, 170, 149, 51},
                        {139, 168, 150, 55}, {136, 167, 151, 58}, {133, 167, 151, 61}, {130, 165, 152, 65}, {127,164,153,68},
                        {124, 164, 153, 71}, {121, 163, 154, 74}, {118, 162, 154, 78}, {115, 161, 155, 81}, {111,161,155,85},
                        {108, 160, 156, 88}, {105, 159, 156, 92}, {102, 158, 157, 95}, { 98, 158, 158, 98}, {  0,0,0,0}};

int coefficient4_3M[18][4] = {{141, 211, 141, 19}, {137, 210, 145, 20}, {132, 208, 148, 24},
                        {127, 207, 151, 27}, {123, 206, 154, 29}, {118, 205, 157, 32}, {114, 203, 160, 35}, {109,202,163,38},
                        {105, 200, 165, 42}, {100, 199, 168, 45}, { 96, 197, 171, 48}, { 92, 195, 173, 52}, { 87,193,176,56},
                        { 83, 191, 178, 60}, { 79, 190, 180, 63}, { 75, 187, 183, 67}, { 71, 185, 185, 71}, {  0,0,0,0}};

int coefficient4_4M[18][4] = {{128, 272, 128, -16}, {121, 271, 135, -15}, {114, 269, 142, -13},
                        {107, 268, 148, -11}, {100, 267, 155, -10}, { 93, 264, 162,  -7}, {87, 262, 168, -5}, {80,260,175,-3},
                        { 74, 257, 181,	0}, { 68, 254, 187, 3}, { 62, 251, 193,	6}, {56, 247, 199, 10}, {50,244,205,13},{45,240,210,17},
                        { 40, 235, 216,  21}, { 35, 231, 221,  25}, { 30, 226, 226,  30}, { 0,   0,0,0}};

int coefficient4_5M[18][4] = {{106, 350, 106, -50}, { 96, 351, 117, -52}, { 85, 350, 128, -51},
                        { 76, 349, 139, -52}, { 66, 348, 150, -52}, { 57, 345, 162, -52}, { 48, 342, 173,-51}, {39, 339, 184,-50},
                        { 30, 335, 196, -49}, { 22, 330, 207, -47}, { 15, 324, 218, -45}, {  7, 318, 229,-42}, { 1, 311, 239,-39},
                        { -6, 304, 250, -36}, {-12, 296, 260, -32}, {-18, 288, 270, -28}, {-23, 279, 279,-23}, { 0,0,0,0}};

int coefficient4_5_3M[18][4] = {{ 97, 376,	97, -58}, { 86, 377, 109, -60}, { 75, 377, 121, -61},
                        { 64, 376, 134, -62}, { 54, 374, 147, -63}, { 43, 372, 160, -63}, { 33, 369, 173,-63}, { 24, 365,186, -63},
                        { 15, 360, 199, -62}, {  7, 355, 212, -62}, { -1, 348, 225, -60}, { -9, 342, 237,-58}, {-16, 333,250, -55},
                        {-23, 325, 262, -52}, {-29, 316, 274, -49}, {-35, 306, 285, -44}, {-40, 296, 296,-40}, {0,0, 0,0}};

int coefficient2_cubic[18][4] = {{0, 511,0, 0}, {0, 511, 1, 0}, {0, 506,6, 0}, {0, 499,13, 0}, {0, 490,22,0},
                        {0, 478,  34, 0}, {0, 465,  47, 0}, {0, 449,  63, 0}, {0, 432,  80, 0}, {0, 413,  99,0}, {0, 393,119,0}, {0, 372, 140, 0},
                        {0, 350, 162, 0}, {0, 328, 184, 0}, {0, 304, 208, 0}, {0, 280, 232, 0}, {0, 256, 256,0}, {0,0,0, 0}};

int coefficient2_5M[18][4] = {{0, 386, 126, 0}, {0, 378, 134, 0}, {0, 370, 142, 0}, {0, 362, 150, 0}, {0, 355, 157, 0},
                        {0, 347, 165, 0}, {0, 338, 174, 0}, {0, 330, 182, 0}, {0, 322, 190, 0}, {0, 314, 198,0}, {0, 306, 206,0}, {0, 298,214, 0},
                        {0, 289, 223, 0}, {0, 281, 231, 0}, {0, 273, 239, 0}, {0, 264, 248, 0}, {0, 256, 256,0}, {0,0,0,0}};

int coefficient2_4M[18][4] = {{0, 371, 141, 0}, {0, 363, 149, 0}, {0, 356, 156, 0}, {0, 348, 164, 0}, {0, 341, 171, 0},
                        {0, 334, 178, 0}, {0, 327, 185, 0}, {0, 319, 193, 0}, {0, 312, 200, 0}, {0, 305, 207,0}, {0, 298, 214,0}, {0, 291,221, 0},
                        {0, 284, 228, 0}, {0, 277, 235, 0}, {0, 270, 242, 0}, {0, 263, 249, 0}, {0, 256, 256,0}, {0,   0,   0,0}};

int coefficient2_3M[18][4] = {{0, 359, 153, 0}, {0, 351, 161, 0}, {0, 344, 168, 0}, {0, 337, 175, 0}, {0, 331, 181, 0},
                        {0, 324, 188, 0}, {0, 317, 195, 0}, {0, 311, 201, 0}, {0, 304, 208, 0}, {0, 298, 214,0}, {0, 292, 220,0}, {0, 286,226, 0},
                        {0, 280, 232, 0},{0, 274, 238, 0}, {0, 268, 244, 0}, {0, 262, 250, 0}, {0, 256, 256, 0}, {0,0, 0, 0}};

int coefficient2_2M[18][4] = {{0, 350, 162, 0}, {0, 343, 169, 0}, {0, 336, 176, 0}, {0, 330, 182, 0}, {0, 323, 189, 0},
                        {0, 317, 195, 0}, {0, 311, 201, 0}, {0, 305, 207, 0}, {0, 299, 213, 0}, {0, 293, 219,0}, {0, 288, 224,0}, 
                        {0, 282,230, 0}, {0, 277, 235, 0},{0, 272, 240, 0}, {0, 266, 246, 0}, {0, 261, 251, 0}, {0, 256, 256, 0}, {0,0, 0,0}};

int coefficient2_1M[18][4] = {{0, 345, 167, 0}, {0, 338, 174, 0}, {0, 331, 181, 0}, {0, 325, 187, 0}, {0, 319, 193,0}, 
                        {0, 313, 199,0},{0, 307, 205, 0}, {0, 301, 211, 0}, {0, 296, 216, 0}, {0, 291, 221, 0}, {0, 285, 227,0}, {0, 280, 232,0}, 
                        {0, 275,237, 0}, {0, 270, 242, 0},{0, 266, 246, 0}, {0, 261, 251, 0}, {0, 256, 256, 0}, {0, 0, 0, 0}};

int coefficient8_5_3M[18][8] = {{35, -70, 102, 373, 102, -70, 35,  5}, {36, -68,  90, 373, 113, -72, 34,  6},
                        {37, -66,  78, 371, 125, -73, 32,  8}, {38, -63,  66, 369, 137, -74, 30,  9}, {38, -60,55, 365,149, -74,28, 11},
                        {38, -56,  45, 362, 161, -75, 25, 12}, {38, -53,  34, 358, 172, -74, 23, 14}, {38, -49,24, 353,184, -73,20, 15},
                        {38, -45,  15, 346, 196, -72, 17, 17}, {37, -41,   6, 340, 207, -70, 14, 19}, {37, -37,-3, 333,219, -68,11, 20},
                        {36, -33, -11, 326, 230, -65,  7, 22}, {35, -29, -19, 318, 241, -62,  4, 24}, {34, -25,-26, 310,252, -58,0, 25},
                        {33, -21, -32, 301, 262, -54, -4, 27}, {31, -16, -39, 293, 273, -50, -8, 28}, {30, -12,-44, 282,282, -44,-12, 30},
                        { 0,   0,0,   0,   0,   0,  0,  0}};

int coefficient8_cubic[18][8] = {{ 0,  0,0, 511,   0,   0,  0,  0}, {-1,  3, -12, 511,  14,-4,  1,  0},
                        {-2,  6, -23, 509,  28,  -8,  2,  0}, {-2,  9, -33, 503,  44, -12,  3,  0}, {-3, 11,-41, 496,61, -16,4,  0},
                        {-3, 13, -48, 488,  79, -21,  5, -1}, {-3, 14, -54, 477,  98, -25,  7, -2}, {-4, 16,-59, 465,118, -30,8, -2},
                        {-4, 17, -63, 451, 138, -35,  9, -1}, {-4, 18, -66, 437, 158, -39, 10, -2}, {-4, 18,-68, 421,180, -44,11, -2},
                        {-4, 18, -69, 404, 201, -48, 13, -3}, {-4, 18, -70, 386, 222, -52, 14, -2}, {-4, 18,-70, 368,244, -56,15, -3},
                        {-4, 18, -69, 348, 265, -59, 16, -3}, {-4, 18, -67, 329, 286, -63, 16, -3}, {-3, 17,-65, 307,307, -65,17, -3},
                        { 0,  0,0,   0,   0,   0,  0,  0}};

int coefficient8_3M[18][8] = {{-46,  29, 165, 236, 165, 29, -46, -20}, {-46,  25, 161, 236, 169, 32, -45, -20},
                        {-47,  21, 158, 236, 173, 37, -45, -21}, {-47,  17, 154, 236, 178, 41, -44, -23}, {-47,14,150,236, 182, 45, -43, -25},
                        {-47,  10, 146, 236, 186, 49, -42, -26}, {-47,   7, 142, 236, 190, 53, -41, -28}, {-47,4, 138,235,194, 58, -40, -30},
                        {-47,   0, 134, 235, 197, 62, -39, -30}, {-47,  -3, 130, 234, 201, 67, -37, -33}, {-46, -6,125,232, 204, 71, -35, -33},
                        {-46,  -9, 121, 232, 207, 76, -34, -35}, {-45, -12, 116, 230, 211, 80, -32, -36}, {-45,-15,112,228, 214, 85, -30, -37},
                        {-43, -18, 108, 227, 216, 89, -28, -39}, {-43, -20, 103, 224, 219, 94, -25, -40}, {-41,-23,98,222, 222, 98, -23, -41},
                        {  0,   0,   0,	0,   0,  0,   0,   0}};

int coefficient8_2M[18][8] = {{14, 66, 113, 133, 113, 66, 14, -7}, {12, 65, 112, 133, 114, 68, 15, -7},
                        {11, 63, 111, 132, 115, 70, 17, -7}, {10, 62, 110, 132, 116, 71, 18, -7}, { 8, 60, 108,132, 118, 73,20, -7},
                        { 7, 58, 107, 132, 119, 75, 21, -7}, { 6, 56, 106, 132, 120, 76, 23, -7}, { 4, 55, 105,132, 121, 78,24, -7},
                        { 4, 53, 103, 131, 122, 80, 26, -7}, { 3, 51, 102, 131, 122, 81, 28, -6}, { 1, 50, 101,131, 123, 83,29, -6},
                        { 1, 48,99, 131, 124, 84, 31, -6}, { 0, 46,  98, 130, 125, 86, 33, -6}, {-1, 45,  97,129, 126, 88,34, -6},
                        {-2, 43,95, 129, 127, 89, 36, -5}, {-3, 41,  94, 128, 127, 91, 38, -4}, {-3, 39,  92,128, 128, 92,39, -3},
                        { 0,	0,   0,   0,   0,  0,  0,  0}};

int coefficient8_1M[18][8] = {{57, 68, 79, 83, 79, 68, 57, 21}, {56, 68, 79, 82, 79, 69, 57, 22},
                        {55, 68, 78, 82, 79, 69, 57, 24}, {54, 67, 78, 82, 79, 69, 58, 25}, {54, 66, 77, 82, 79,69, 58, 27},
                        {53, 66, 77, 81, 79, 70, 58, 28}, {52, 66, 77, 81, 79, 70, 58, 29}, {51, 65, 76, 81, 79,70, 59, 31},
                        {50, 65, 76, 81, 79, 70, 59, 32}, {49, 64, 75, 81, 79, 71, 59, 34}, {48, 63, 75, 81, 79,71, 60, 35},
                        {47, 63, 75, 81, 79, 71, 60, 36}, {46, 63, 74, 81, 80, 71, 60, 37}, {45, 62, 74, 80, 80,72, 60, 39},
                        {44, 62, 73, 80, 80, 72, 61, 40}, {43, 62, 73, 80, 80, 72, 61, 41}, {42, 61, 73, 80, 80,73, 61, 42},
                        { 0,0,0,0,0,0,0,0}};

int coefficient8_lanczos2_8tap[18][8] = {{-16,0,145,254,145,0,-16,0},{-16,-2,140,253,151,3,-17,0},
                        {-15,-5,135,253,157,5,-18,0},{-14,-7,129,252,162,8,-18,0},{-13,-9,123,252,167,11,-19,0},
                        {-13,-11,118,250,172,15,-19,0},{-12,-12,112,250,177,18,-20,-1},{-11,-14,107,247,183,21,-20,-1},
                        {-10,-15,101,245,188,25,-21,-1},{-9,-16,96,243,192,29,-21,-2},{-8,-18,90,242,197,33,-22,-2},
                        {-8,-19,85,239,202,37,-22,-2},{-7,-19,80,236,206,41,-22,-3},{-7,-20,75,233,210,46,-22,-3},
                        {-6,-21,69,230,215,50,-22,-3},{-5,-21,65,226,219,55,-22,-5},{-5,-21,60,222,222,60,-21,-5},
                        {0,0,0,0,0,0,0,0}};

int coefficient_lanczos2[18][4] = {{0,511,0,0},{-10,511,11,0},{-18,508,23,-1},
                        {-25,502,36,-1},{-31,494,51,-2},{-35,484,66,-3},{-39,473,83,-5},{-41,460,101,-8},
                        {-43,445,119,-9},{-44,428,139,-11},{-44,411,159,-14},{-43,392,180,-17},{-41,373,201,-21},
                        {-40,353,222,-23},{-37,331,244,-26},{-35,310,266,-29},{-32,288,288,-32},{0,0,0,0}};

int coefficient_lanczos3[18][8] ={{4,-22,40,469,40,-22,4,0},{3,-18,26,468,54,-26,5,0},{3,-14,14,466,68,-30,6,0},
                        {2,-11,2,462,84,-34,7,0},{1,-7,-9,457,100,-38,8,0},{1,-4,-18,451,116,-42,9,0},
                        {1,-1,-27,443,133,-46,10,0},{0,2,-35,434,151,-50,10,0},{0,4,-42,424,168,-54,11,0},
                        {0,6,-49,413,186,-57,12,0},{0,8,-54,401,204,-60,13,0},{0,10,-58,387,222,-62,13,0},
                        {0,11,-62,373,240,-65,14,0},{0,12,-65,358,258,-66,14,0},{0,13,-67,343,276,-68,14,0},
                        {0,14,-68,327,293,-68,14,0},{0,14,-68,310,310,-68,14,0},{0,0,0,0,0,0,0,0}};

const int coefficient6_cubic[18][6] = {{0,0,511,0,0,0},{3,-12,511,13,-3,0},{6,-22,507,28,-7,0},
                        {8,-32,502,44,-11,1},{10,-40,495,61,-15,1},{11,-47,486,79,-19,2},{12,-53,476,98,-24,3},
                        {13,-58,464,117,-28,4},{14,-62,451,137,-33,5},{15,-65,437,157,-38,6},{15,-67,420,179,-42,7},
                        {15,-68,404,200,-46,7},{14,-68,386,221,-50,9},{14,-68,367,243,-54,10},{14,-67,348,264,-58,11},
                        {13,-66,328,286,-61,12},{13,-63,306,306,-63,12},{0,0,0,0,0,0}};

const int coefficient6_1M[18][6] = {{89,98,104,98,89,36},{88,97,103,98,89,38},
                        {87,96,103,97,89,40},{86,96,102,97,89,42},{84,95,102,97,89,44},{83,94,102,97,89,47},
                        {82,94,101,97,89,49},{81,93,101,97,89,51},{80,93,100,97,89,53},{78,92,100,97,89,55},
                        {77,92,100,97,89,57},{76,91,99,97,89,59},{74,91,99,98,89,61},{73,91,99,98,90,62},
                        {71,91,99,98,90,64},{69,90,98,98,90,66},{68,90,98,98,90,68},{0,0,0,0,0,0}};

const int coefficient6_1_5M[18][6] = {{80,105,116,105,80,26},{79,104,116,105,81,28},
                        {77,103,115,106,81,29},{76,102,115,106,82,31},{74,101,115,106,83,33},{73,100,114,106,84,35},
                        {71,99,114,107,84,37},{70,98,113,107,85,39},{68,98,113,107,86,40},{67,97,112,108,86,42},
                        {65,96,112,108,87,44},{63,95,112,108,88,46},{62,94,111,108,88,48},{60,93,111,109,89,50},
                        {58,93,111,109,90,51},{57,92,110,110,90,53},{55,91,110,110,91,55},{0,0,0,0,0,0}};

const int coefficient6_2M[18][6] = {{66,115,137,116,66,12},{64,114,136,116,68,14},{63,113,135,117,70,14},
                        {61,111,135,118,71,16},{59,110,134,119,73,17},{57,108,134,120,74,19},{55,107,133,121,76,20},
                        {53,105,133,121,78,22},{51,104,133,122,79,23},{49,102,132,123,81,25},{47,101,132,124,82,26},
                        {45,99,131,125,84,28},{44,98,130,125,85,30},{42,96,130,126,87,31},{40,95,129,127,89,32},
                        {38,93,129,127,90,35},{36,92,128,128,92,36},{0,0,0,0,0,0}};

const int coefficient6_3_5M[18][6] = {{-11,154,253,154,-11,-28},{-14,149,254,160,-7,-29},
                        {-17,144,255,165,-3,-31},{-20,139,255,171,1,-33},{-23,133,255,177,5,-34},{-26,128,254,182,9,-35},
                        {-28,122,254,188,13,-37},{-31,117,253,193,18,-38},{-33,111,252,198,23,-39},{-35,106,250,203,28,-40},
                        {-36,100,248,208,33,-41},{-38,94,246,212,38,-41},{-39,88,244,217,43,-42},{-40,83,242,221,49,-42},
                        {-41,77,239,225,54,-42},{-42,71,236,229,60,-42},{-42,66,232,232,66,-42},{0,0,0,0,0,0}};

const int coefficient6_3M[18][6] = {{21,142,204,142,21,-18},{18,139,204,146,24,-18},
                        {15,136,204,149,28,-19},{12,132,204,153,31,-19},{9,129,204,156,35,-20},{6,125,203,160,38,-20},
                        {3,121,203,163,42,-20},{1,118,202,166,46,-20},{-1,114,201,169,50,-20},{-4,110,200,172,54,-20},
                        {-6,106,199,175,58,-20},{-8,102,198,178,62,-19},{-10,98,196,180,66,-19},{-11,94,195,183,70,-18},
                        {-13,90,193,185,74,-17},{-14,86,191,187,78,-16},{-15,82,189,189,82,-15},{0,0,0,0,0,0}};

const int coefficient6_3_25M[18][6] = {{6,149,227,149,6,-24},{2,145,228,153,9,-25},
                        {-1,140,228,158,13,-26},{-4,136,228,162,17,-27},{-7,132,228,167,20,-28},{-10,127,228,171,25,-29},
                        {-12,123,227,175,29,-29},{-15,118,226,180,33,-30},{-17,114,225,184,37,-31},{-19,109,224,187,42,-31},
                        {-21,104,223,191,46,-31},{-23,99,221,195,51,-31},{-25,95,219,198,56,-31},{-26,90,217,201,61,-31},
                        {-27,85,215,205,65,-31},{-28,80,213,207,70,-30},{-29,75,210,210,75,-29},{0,0,0,0,0,0}};

const int coefficient6_4M[18][6] = {{-43,158,310,158,-43,-28},{-46,151,311,166,-40,-30},{-48,143,311,175,-37,-32},
                        {-51,136,312,183,-33,-35},{-53,128,312,191,-29,-37},{-55,121,311,200,-25,-40},{-57,113,311,208,-21,-42},
                        {-58,106,309,216,-16,-45},{-59,98,307,223,-11,-46},{-60,90,305,231,-6,-48},{-61,83,302,238,0,-50},
                        {-61,75,299,246,6,-53},{-61,67,296,252,12,-54},{-61,60,291,259,18,-55},{-60,53,287,265,25,-58},
                        {-60,45,283,271,31,-58},{-59,38,277,277,38,-59},{0,0,0,0,0,0}};

const int coefficient6_5M[18][6] = {{-78,130,403,130,-78,5},{-77,118,404,142,-78,3},{-76,106,404,155,-78,1},
                        {-75,94,403,168,-78,0},{-73,82,401,181,-78,-1},{-71,71,399,195,-77,-5},{-69,60,396,208,-75,-8},
                        {-66,49,392,220,-73,-10},{-64,38,387,233,-71,-11},{-61,28,382,246,-68,-15},{-58,18,376,258,-64,-18},
                        {-55,9,369,271,-60,-22},{-52,0,362,282,-56,-24},{-48,-9,354,294,-51,-28},{-45,-17,345,305,-45,-31},
                        {-41,-25,336,316,-39,-35},{-38,-32,326,326,-32,-38},{0,0,0,0,0,0}};

const int coefficient6_6M[18][6] = {{-58,75,443,75,-58,35},{-53,61,441,89,-62,36},{-48,47,439,104,-66,36},
                        {-43,34,436,119,-69,35},{-38,21,432,134,-73,36},{-33,10,426,149,-76,36},{-28,-2,420,165,-78,35},
                        {-23,-12,413,180,-80,34},{-18,-22,405,196,-82,33},{-14,-31,397,211,-83,32},{-9,-39,386,227,-83,30},
                        {-4,-47,376,242,-83,28},{0,-54,365,257,-83,27},{4,-60,353,272,-81,24},{8,-65,341,286,-79,21},
                        {12,-70,328,301,-77,18},{15,-74,315,315,-74,15},{0,0,0,0,0,0}};

const int coefficient_lanczos2_6tap[18][6] = {{-29,116,338,116,-29,0},{-28,106,338,125,-29,0},
                        {-28,97,337,135,-29,0},{-27,88,336,145,-29,0},{-26,80,333,154,-29,-1},{-25,71,331,164,-28,-1},
                        {-24,63,327,174,-27,-1},{-23,55,324,184,-26,-2},{-22,48,319,194,-24,-3},{-20,40,314,203,-22,-3},
                        {-19,34,309,213,-20,-4},{-17,27,303,223,-18,-5},{-16,21,296,232,-15,-6},{-15,15,290,241,-12,-7},
                        {-13,10,282,250,-8,-8},{-12,5,275,258,-4,-9},{-11,0,267,267,0,-11},{0,0,0,0,0,0}};

const int coefficient_guassian_6tap_6M[18][6] = {{-50,55,459,55,-50,42},{-44,40,456,70,-56,44},
                        {-37,26,452,86,-61,46},{-31,13,447,101,-66,48},{-24,0,441,117,-71,49},{-18,-12,434,133,-75,50},
                        {-12,-23,426,149,-79,51},{-6,-33,417,165,-83,51},{0,-42,407,182,-86,51},{6,-51,397,198,-88,51},
                        {11,-59,386,214,-90,50},{16,-65,374,230,-91,49},{21,-71,361,246,-92,47},{25,-77,348,261,-92,45},
                        {30,-81,335,277,-91,43},{33,-85,321,292,-90,40},{37,-87,307,307,-87,37},{0,0,0,0,0,0}}; 

const int coefficient6_5_8M[18][6] = {{-58,75,443,75,-58,35},{-53,61,441,89,-62,36},
                        {-48,47,439,104,-66,36},{-43,34,436,119,-69,36},{-38,21,431,134,-73,36},{-33,10,426,149,-76,36},
                        {-28,-2,420,165,-78,35},{-23,-12,413,180,-80,35},{-18,-22,405,196,-82,34},{-14,-31,396,211,-83,32},
                        {-9,-39,386,227,-83,31},{-4,-47,376,242,-83,29},{0,-54,365,257,-83,27},{4,-60,353,272,-81,24},
                        {8,-65,341,286,-79,22},{12,-70,328,301,-77,19},{15,-74,314,314,-74,15},{0,0,0,0,0,0}};

const int coefficient6_5_6M[18][6] = {{-70,97,432,97,-70,27},{-67,83,431,111,-73,27},
                        {-63,70,430,125,-76,26},{-59,57,428,139,-78,26},{-55,44,424,154,-80,25},{-51,32,420,169,-82,24},
                        {-47,21,415,183,-83,22},{-43,10,409,198,-83,21},{-38,-1,402,213,-83,19},{-34,-11,395,228,-83,17},
                        {-29,-20,387,242,-82,14},{-25,-29,377,256,-80,12},{-21,-37,368,270,-78,9},{-16,-44,357,284,-75,6},
                        {-12,-51,346,297,-71,3},{-8,-57,335,310,-67,-1},{-4,-62,323,323,-62,-4},{0,0,0,0,0,0}};


//new coefficients
//---------------8 tap----------------------------
//4.752M
const int coefficient8_6M_a30[18][8] = {{11,-35,76,412,76,-35,11,-3},{11,-33,64,411,88,-38,12,-3},
                        {10,-30,52,410,101,-41,12,-3},{10,-27,41,407,114,-43,12,-3},{9,-24,31,404,128,-45,12,-3},
                        {8,-21,21,399,142,-47,12,-2},{8,-18,12,394,156,-49,12,-2},{7,-16,4,388,170,-50,12,-2},
                        {6,-13,-4,380,184,-51,12,-2},{6,-10,-12,372,199,-52,11,-2},{5,-8,-18,364,213,-53,11,-1},
                        {4,-6,-25,354,227,-53,10,-1},{4,-3,-30,344,242,-52,9,-1},{3,-1,-35,333,256,-51,8,0},
                        {2,1,-39,321,270,-50,7,0},{2,3,-43,309,283,-48,6,1},{1,4,-46,296,296,-46,4,1},
                        {0,0,0,0,0,0,0,0}};
//4.14M
const int coefficient8_5M_a25[18][8] = {{7,-42,109,363,109,-42,7,1},{7,-41,99,362,120,-43,6,1},
                        {8,-40,89,361,131,-43,6,1},{8,-39,79,359,142,-44,5,2},{8,-37,69,356,152,-43,4,2},
                        {9,-36,60,353,164,-43,3,2},{9,-34,51,349,175,-43,2,3},{9,-32,43,345,186,-42,1,3},
                        {9,-30,34,340,197,-40,-1,3},{9,-28,27,334,208,-39,-2,4},{9,-26,19,328,219,-37,-3,4},
                        {8,-24,12,321,229,-34,-5,5},{8,-22,6,314,240,-32,-7,5},{8,-20,-1,306,250,-28,-8,6},
                        {7,-18,-6,297,260,-25,-10,6},{7,-16,-12,289,270,-21,-12,6},{7,-14,-16,280,280,-16,-14,7},
                        {0,0,0,0,0,0,0,0}};
//3.24M
const int coefficient8_4M_a25[18][8] = {{-7,-21,133,299,133,-21,-7,2},{-6,-22,126,299,141,-20,-8,2},
                        {-5,-23,118,298,148,-18,-9,2},{-4,-24,110,297,156,-16,-9,2},{-4,-24,103,296,164,-14,-10,2},
                        {-3,-25,96,294,171,-12,-11,2},{-3,-25,89,291,179,-10,-12,2},{-2,-25,82,289,187,-7,-13,2},
                        {-1,-25,75,286,194,-4,-14,2},{-1,-25,68,282,201,-1,-15,2},{0,-25,62,278,209,3,-16,2},
                        {0,-24,56,274,216,6,-17,2},{0,-24,50,269,222,10,-18,2},{1,-23,44,264,229,14,-19,2},
                        {1,-23,38,259,236,19,-20,2},{1,-22,33,254,242,23,-21,2},{1,-21,28,248,248,28,-21,1},
                        {0,0,0,0,0,0,0,0}};
//2.426M
const int coefficient8_3M_a19[18][8] = {{-17,19,144,226,144,19,-17,-4},{-17,16,139,226,148,21,-17,-4},
                        {-17,13,135,226,152,24,-18,-5},{-17,11,131,226,157,27,-18,-5},{-17,9,126,225,161,30,-17,-5},
                        {-16,6,122,225,165,33,-17,-6},{-16,4,118,224,169,37,-17,-6},{-16,2,113,223,173,40,-17,-7},
                        {-15,0,109,221,177,43,-17,-7},{-15,-1,104,220,181,47,-16,-8},{-14,-3,100,218,185,51,-16,-8},
                        {-14,-5,96,216,188,54,-15,-9},{-14,-6,91,214,192,58,-14,-9},{-13,-7,87,212,195,62,-14,-10},
                        {-13,-9,83,209,198,66,-13,-10},{-12,-10,79,207,201,70,-12,-11},{-12,-11,74,204,204,74,-11,-12},
                        {0,0,0,0,0,0,0,0}};
//---------------6 tap----------------------------
//4.667M
const int coefficient6_6M_a25[18][6] = {{-34,78,415,78,-34,9},{-31,66,415,90,-36,9},
                        {-29,54,413,103,-38,9},{-26,43,410,116,-41,9},{-23,33,406,129,-42,9},{-21,24,401,143,-44,9},
                        {-18,14,396,157,-46,9},{-16,6,389,171,-47,9},{-13,-2,382,185,-48,9},{-11,-9,373,199,-49,8},
                        {-9,-16,364,213,-49,8},{-7,-21,354,228,-49,7},{-5,-27,344,242,-49,6},{-3,-31,333,256,-48,6},
                        {-1,-36,321,269,-46,4},{0,-39,309,283,-44,3},{2,-42,296,296,-42,2},{0,0,0,0,0,0}};
//3.888M
const int coefficient6_5M_a25[18][6] = {{-31,104,362,104,-31,4},{-30,94,361,114,-32,4},
                        {-29,84,360,125,-32,3},{-28,75,359,136,-33,3},{-26,66,356,147,-33,3},{-25,57,353,158,-33,2},
                        {-23,49,349,169,-33,2},{-22,41,344,180,-32,1},{-20,33,339,191,-31,0},{-19,26,333,203,-30,-1},
                        {-17,19,327,214,-29,-2},{-16,13,320,225,-27,-3},{-14,7,312,236,-25,-4},{-13,1,304,246,-22,-5},
                        {-11,-4,295,257,-19,-6},{-10,-8,286,267,-16,-7},{-8,-12,277,277,-12,-8},{0,0,0,0,0,0}};
//3.216M
const int coefficient6_4M_a20[18][6] = {{-20,130,297,130,-20,-5},{-21,122,297,138,-19,-6},
                        {-22,115,297,146,-17,-7},{-22,108,296,153,-16,-7},{-23,101,295,161,-14,-8},{-23,93,294,169,-12,-9},
                        {-23,87,292,177,-10,-10},{-24,80,289,185,-7,-11},{-23,73,286,193,-4,-12},{-23,66,283,200,-1,-13},
                        {-23,60,279,208,2,-14},{-23,54,275,215,5,-15},{-22,48,270,222,9,-16},{-21,42,265,229,13,-17},
                        {-21,37,260,236,17,-18},{-20,32,255,242,22,-18},{-19,27,249,249,27,-19},{0,0,0,0,0,0}};
//2.16M
const int coefficient6_3M_a15[18][6] = {{16,136,217,136,16,-9},{13,132,217,141,18,-9},
                        {11,128,217,145,21,-10},{9,124,217,149,24,-10},{7,119,216,153,27,-10},{5,115,216,157,30,-11},
                        {3,111,215,161,33,-11},{1,107,214,165,36,-11},{0,102,212,169,39,-11},{-2,98,211,173,43,-11},
                        {-3,94,209,177,46,-11},{-4,90,207,180,50,-11},{-5,85,205,183,53,-11},{-6,81,203,187,57,-10},
                        {-7,77,201,190,61,-10},{-8,73,198,193,65,-9},{-9,69,196,196,69,-9},{0,0,0,0,0,0}};
//5.089M
const int coefficient6_675M_a25[18][6] = {{-29,56,447,56,-29,10},{-25,44,445,70,-32,10},
                        {-22,32,443,83,-35,11},{-19,20,439,98,-38,11},{-15,10,435,112,-41,12},{-12,0,429,128,-44,12},
                        {-10,-9,422,143,-47,13},{-7,-17,414,159,-50,13},{-4,-24,404,175,-52,13},{-2,-31,394,191,-54,13},
                        {0,-37,383,207,-56,13},{3,-42,372,224,-57,13},{4,-46,359,240,-58,13},{6,-50,346,256,-58,12},
                        {8,-53,332,272,-58,12},{9,-55,318,287,-58,11},{10,-57,303,303,-57,10},{0,0,0,0,0,0}};

//---------------4 tap----------------------------
//4.456M
const int coefficient4_6M_a15[18][4] = {{78,392,78,-35},{67,393,89,-37},{56,393,102,-39},
                        {46,392,115,-41},{36,390,128,-43},{27,387,142,-44},{18,383,155,-45},{10,379,170,-46},{3,373,184,-47},
                        {-5,366,198,-47},{-11,358,213,-47},{-17,350,227,-47},{-23,340,241,-46},{-28,330,255,-45},{-32,319,269,-44},
                        {-36,307,282,-41},{-39,295,295,-39},{0,0,0,0}};
//4.272M
const int coefficient4_6M_a19[18][4] = {{77,386,77,-28},{66,387,88,-29},{56,387,100,-31},
                        {47,385,112,-32},{38,383,125,-34},{29,380,138,-35},{21,376,151,-36},{13,371,165,-37},{6,365,179,-38},
                        {0,358,192,-38},{-6,350,206,-38},{-12,342,220,-38},{-17,332,234,-37},{-22,322,248,-36},{-25,311,261,-35},
                        {-28,299,274,-33},{-31,287,287,-31},{0,0,0,0}};
//3.586M
const int coefficient4_5M_a10[18][4] = {{106,334,106,-34},{97,334,116,-35},{87,334,126,-35},
                        {78,333,136,-35},{70,331,147,-35},{61,329,157,-35},{53,326,168,-35},{45,323,178,-34},{37,319,189,-33},
                        {30,314,199,-31},{23,309,209,-29},{17,303,220,-27},{10,297,229,-25},{5,290,239,-22},{-1,283,249,-18},
                        {-6,275,258,-15},{-10,266,266,-10},{0,0,0,0}};
//3.507M
const int coefficient4_5M_a15[18][4] = {{102,335,102,-29},{92,335,112,-27},{84,335,121,-28},
                        {75,334,131,-28},{67,332,141,-28},{59,329,152,-28},{51,326,162,-27},{43,323,173,-27},{36,319,183,-26},
                        {30,313,194,-25},{23,308,204,-23},{17,301,215,-21},{12,295,225,-20},{6,288,235,-17},{2,280,244,-14},
                        {-3,271,254,-10},{-7,263,263,-7},{0,0,0,0}};
//4.720M
const int coefficient4_675M_a20[18][4] = {{60,417,60,-25},{49,418,72,-28},{39,418,85,-30},
                        {29,417,99,-32},{19,414,113,-34},{10,411,127,-36},{2,406,142,-38},{-5,400,158,-40},{-12,393,173,-42},
                        {-18,384,189,-43},{-24,375,205,-45},{-29,365,222,-45},{-33,353,238,-46},{-37,341,254,-46},{-40,328,269,-46},
                        {-42,314,285,-45},{-44,300,300,-44},{0,0,0,0}};
//3.032M
const int coefficient4_4_5M_a15[18][4] = {{112,307,112,-18},{103,307,120,-18},{95,306,128,-18},
                        {88,305,137,-18},{80,303,146,-17},{73,301,154,-16},{66,298,163,-15},{59,295,172,-14},{52,291,181,-12},
                        {46,287,189,-10},{40,283,198,-8},{34,277,207,-6},{29,272,215,-3},{24,266,223,-1},{19,260,231,3},
                        {14,253,239,6},{10,246,246,10},{0,0,0,0}};
//2.657M
const int coefficient4_4M_a15[18][4] = {{120,281,120,-9},{113,281,127,-9},{106,280,134,-8},
                        {99,279,141,-7},{92,277,148,-5},{85,275,156,-4},{79,273,163,-2},{73,270,170,0},{67,267,177,2},
                        {61,263,184,4},{55,259,191,6},{50,255,198,9},{45,251,205,12},{40,246,211,15},{35,241,218,19},
                        {31,235,224,22},{26,230,230,26},{0,0,0,0}};
//---------------2 tap----------------------------
//3.717M
const int coefficient2_6M_1_3[18][4] = {{0,420,92,0},{0,412,100,0},{0,404,108,0},{0,395,117,0},{0,386,126,0},
                        {0,376,136,0},{0,366,146,0},{0,356,156,0},{0,346,166,0},{0,335,177,0},{0,325,187,0},{0,313,199,0},{0,302,210,0},
                        {0,291,221,0},{0,279,233,0},{0,268,244,0},{0,256,256,0},{0,0,0,0}};
//3.56M
const int coefficient2_5M_1_0[18][4] = {{0,397,115,0},{0,389,123,0},{0,381,131,0},{0,373,139,0},{0,365,147,0},
                        {0,356,156,0},{0,347,165,0},{0,339,173,0},{0,330,182,0},{0,321,191,0},{0,312,200,0},{0,303,209,0},{0,293,219,0},
                        {0,284,228,0},{0,275,237,0},{0,265,247,0},{0,256,256,0},{0,0,0,0}};
//3.39M
const int coefficient2_4M_0_1[18][4] = {{0,366,146,0},{0,359,153,0},{0,351,161,0},{0,344,168,0},{0,337,175,0},
                        {0,330,182,0},{0,323,189,0},{0,316,196,0},{0,309,203,0},{0,302,210,0},{0,296,216,0},{0,289,223,0},{0,282,230,0},
                        {0,276,236,0},{0,269,243,0},{0,263,249,0},{0,256,256,0},{0,0,0,0}};

const int *g_pOrgZoomCoef[VPP_ZOOM_COEF_BUTT][VPP_ZOOM_TAP_BUTT] =
{
    //VPP_ZOOM_TAP_8LH,           VPP_ZOOM_TAP_6LV,           VPP_ZOOM_TAP_4CH,         VPP_ZOOM_TAP_4CV,   VPP_ZOOM_TAP_2CV,
    {&coefficient_lanczos3[0][0], &coefficient6_6M_a25[0][0],  &coefficient4_5M_a15[0][0],  &coefficient4_5M_a15[0][0], &coefficient2_6M_1_3[0][0]}, //>1
    {&coefficient8_cubic[0][0], &coefficient6_cubic[0][0], &coefficient4_cubic[0][0], &coefficient4_cubic[0][0],  &coefficient2_cubic[0][0]},  //==1
    {&coefficient8_lanczos2_8tap[0][0], &coefficient6_5M_a25[0][0], &coefficient4_5M_a15[0][0], &coefficient4_5M_a15[0][0], &coefficient2_5M[0][0]},//>=0.75   
    {&coefficient8_lanczos2_8tap[0][0], &coefficient6_4M_a20[0][0], &coefficient4_5M_a15[0][0],&coefficient4_5M_a15[0][0], &coefficient2_5M_1_0[0][0]},//>=0.5
    {&coefficient8_3M_a19[0][0], &coefficient6_3M_a15[0][0], &coefficient4_4M_a15[0][0], &coefficient4_4M_a15[0][0], &coefficient2_4M_0_1[0][0]},           //>=0.33 
    {&coefficient8_3M_a19[0][0], &coefficient6_3M_a15[0][0], &coefficient4_4M_a15[0][0], &coefficient4_4M_a15[0][0], &coefficient2_4M_0_1[0][0]},           //>=0.25 
    {&coefficient8_3M_a19[0][0], &coefficient6_3M_a15[0][0], &coefficient4_4M_a15[0][0], &coefficient4_4M_a15[0][0], &coefficient2_4M_0_1[0][0]}           //else
};
//add for zme coef config by l50053, end

/**************************************************************
宏功能单元定义
*/
//获取VPP Layer句柄
#define VPP_GET_HANDLE(enLayer, pstVpp) \
do{                                  \
    pstVpp = &(s_stVPPLayer[(int)enLayer]); \
}while(0)


/**************************************************************
基本功能函数定义
*/

// 初始化视频层(当前仅支持视频层1)
void inter_init_layer(HAL_LAYER_E enLayer)
{
    VPP_VPP_S *pstVpp = NULL;
    int s32Coef[8] = {0,13,-63,306,306,-63,13,0};

    logd();
    
    VPP_GET_HANDLE(enLayer, pstVpp);
    
    pstVpp->bopened = false;

    pstVpp->enLayer = enLayer;
    pstVpp->boffline_mode_en = false;

    pstVpp->st_in_rect.s32X = 0;
    pstVpp->st_in_rect.s32Y = 0;
    pstVpp->st_in_rect.s32Width = 320;
    pstVpp->st_in_rect.s32Height = 240;

    pstVpp->st_out_rect.s32X = 0;
    pstVpp->st_out_rect.s32Y = 0;
    pstVpp->st_out_rect.s32Width = 320;
    pstVpp->st_out_rect.s32Height = 240;

    pstVpp->bcsc_enable = false;
    pstVpp->bzoom_enable = false;

    hal_set_rd_bus_id(1);
    //1 as default outstanding value
    if( 0 == pstVpp->axi_ostd_r0 )
    {
        pstVpp->axi_ostd_r0 = 1;
    }
    
    if( 0 == pstVpp->axi_ostd_r1 )
    {
        pstVpp->axi_ostd_r1 = 1;
    }
    
    if( 0 == pstVpp->axi_ostd_wr )
    {
        pstVpp->axi_ostd_wr = 1;
    }
    hal_set_rd_out_std(0, pstVpp->axi_ostd_r0);  /* AXI总线读ID0的outstanding。*/
    hal_set_rd_out_std(1, pstVpp->axi_ostd_r1);  /* resident */
    hal_set_wr_out_std(pstVpp->axi_ostd_wr);

    //1 set video layer ifir enable
    hal_set_ifir_mode(HAL_LAYER_VIDEO1, HAL_IFIRMODE_DOUBLE);
    
    hal_set_ifir_coef(HAL_LAYER_VIDEO1, s32Coef);

    hal_set_die_def_thd(HAL_LAYER_VIDEO1);
    hal_set_pd_defthd (HAL_LAYER_VIDEO1);  /* pull down */

    //1 HAL Clock gate ctrl enable
    hal_set_clk_gate_en(1);

    hal_set_lnk_lst_node_int_en(1); /*wbc1 int enable */

    hal_set_zme_enable (HAL_LAYER_VIDEO1, HAL_ZMEMODE_ALL, 0);        
    hal_set_zme_fir_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_ALL, 0);        
    hal_set_mid_enable (HAL_LAYER_VIDEO1, HAL_ZMEMODE_ALL, 0);

    hal_set_die_enable (HAL_LAYER_VIDEO1, 0, 0);
}

// 去初始化视频层(目前仅支持视频层1)
void inter_deinit_layer(HAL_LAYER_E enLayer)
{
    logd();
    hal_set_clk_gate_en(0);
    hal_set_lnk_lst_node_int_en(0); /*wbc1 deint disable */
}

//modified for zme coef config by l50053, begin
static __inline int inter_bitvalue(int s32Value)
{
    return s32Value < 0 ? s32Value : s32Value;
}

static void inter_translate_zoomcoef(const int *ps32Coef, VPP_ZOOM_TAP_E enTap,
                                  HAL_ZOOM_BITARRAY_S *pBitCoef)
{
    unsigned int i = 0, u32Cnt = 0, u32Tap = 0, u32Tmp = 0;

    BUG_ON(NULL == ps32Coef );
    BUG_ON(enTap >= VPP_ZOOM_TAP_BUTT);
    BUG_ON(NULL == pBitCoef );
    
    switch (enTap)
    {
        case VPP_ZOOM_TAP_8LH:
        {
            u32Tap = 8;
            break;
        }
        case VPP_ZOOM_TAP_6LV:
        {
            u32Tap = 6;
            break;
        }
        case VPP_ZOOM_TAP_4CH:
        {
            u32Tap = 4;
            break;
        }
        case VPP_ZOOM_TAP_4CV:
        {
            u32Tap = 4;
            break;
        }
        case VPP_ZOOM_TAP_2CV:
        {
            u32Tap = 4;
            break;
        }
        default:
        {
            u32Tap = 4;
            break;
        }
    }

    u32Cnt = 18 * u32Tap / 12;
    for (i = 0; i < u32Cnt; i++)
    {
        pBitCoef->stBit[i].bits_0 = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_1 = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_2 = inter_bitvalue(*ps32Coef++);

        u32Tmp = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_32 = u32Tmp;
        pBitCoef->stBit[i].bits_38 = (u32Tmp >> 2);

        pBitCoef->stBit[i].bits_4 = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_5 = inter_bitvalue(*ps32Coef++);

        u32Tmp = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_64 = u32Tmp;
        pBitCoef->stBit[i].bits_66 = u32Tmp >> 4;

        pBitCoef->stBit[i].bits_7 = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_8 = inter_bitvalue(*ps32Coef++);

        u32Tmp = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_96 = u32Tmp;
        pBitCoef->stBit[i].bits_94 = u32Tmp >> 6;

        pBitCoef->stBit[i].bits_10 = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_11 = inter_bitvalue(*ps32Coef++);
        pBitCoef->stBit[i].bits_12 = 0;
    }

    pBitCoef->u32Size = u32Cnt * sizeof(HAL_ZOOM_BIT_S);

}

static void inter_load_zoomcoef_h(VPP_ZOOM_COEF_E enCoef, unsigned char *pu8Addr)
{
    HAL_ZOOM_BITARRAY_S stArray;
    memset(&stArray, 0 , sizeof(HAL_ZOOM_BITARRAY_S));

    BUG_ON(NULL == pu8Addr);
    
    // 亮度
    inter_translate_zoomcoef(g_pOrgZoomCoef[enCoef][VPP_ZOOM_TAP_8LH], VPP_ZOOM_TAP_8LH, &stArray);
    memcpy(pu8Addr, stArray.stBit, stArray.u32Size);
    pu8Addr += stArray.u32Size;

    inter_translate_zoomcoef(g_pOrgZoomCoef[enCoef][VPP_ZOOM_TAP_4CH], VPP_ZOOM_TAP_4CH, &stArray);
    memcpy(pu8Addr, stArray.stBit, stArray.u32Size);

    return;
}

static void inter_load_zoomcoef_v(VPP_ZOOM_COEF_E enCoef, VPP_ZOOM_TAP_E enLZoomTap, VPP_ZOOM_TAP_E enChZoomTap, unsigned char *pu8Addr)
{
    HAL_ZOOM_BITARRAY_S stArray;
    memset(&stArray, 0 , sizeof(HAL_ZOOM_BITARRAY_S));

    BUG_ON(NULL == pu8Addr);
    // 亮度
    inter_translate_zoomcoef(g_pOrgZoomCoef[enCoef][enLZoomTap], enLZoomTap, &stArray);
    memcpy(pu8Addr, stArray.stBit, stArray.u32Size);
    pu8Addr += stArray.u32Size;

    // 色度
    inter_translate_zoomcoef(g_pOrgZoomCoef[enCoef][enChZoomTap], enChZoomTap, &stArray);
    memcpy(pu8Addr, stArray.stBit, stArray.u32Size);
    
    return;
}

static void inter_load_zoomcoef(HAL_FIR_COEF_ADDR_S *pstCoefAddr, unsigned int  PhyAddr, unsigned int  VirAddr)
{
    unsigned char *pCurAddr;
    unsigned int  nSize;

    pCurAddr = (unsigned char *)VirAddr;

    nSize = 288; // (8x18) / 12 * 16 + (4x18) / 12 * 16 = 288
    inter_load_zoomcoef_h(VPP_ZOOM_COEF_1, pCurAddr);
    pstCoefAddr->coef_addr_tap_l8c4_1 = PhyAddr;
    PhyAddr  += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_h(VPP_ZOOM_COEF_EQU_1, pCurAddr);
    pstCoefAddr->coef_addr_tap_l8c4_equal1 = PhyAddr;
    PhyAddr  += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_h(VPP_ZOOM_COEF_075, pCurAddr);
    pstCoefAddr->coef_addr_tap_l8c4_075 = PhyAddr;
    PhyAddr  += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_h(VPP_ZOOM_COEF_05, pCurAddr);
    pstCoefAddr->coef_addr_tap_l8c4_05 = PhyAddr;
    PhyAddr  += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_h(VPP_ZOOM_COEF_033, pCurAddr);
    pstCoefAddr->coef_addr_tap_l8c4_033 = PhyAddr;
    PhyAddr  += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_h(VPP_ZOOM_COEF_025, pCurAddr);
    pstCoefAddr->coef_addr_tap_l8c4_025 = PhyAddr;
    PhyAddr  += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_h(VPP_ZOOM_COEF_0, pCurAddr);
    pstCoefAddr->coef_addr_tap_l8c4_0 = PhyAddr;
    PhyAddr  += nSize;
    pCurAddr += nSize;

    nSize = 240; // (6x18) / 12 * 16 + (4x18) / 12 * 16 = 240
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_1, VPP_ZOOM_TAP_6LV,  VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l6c4_1 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_EQU_1, VPP_ZOOM_TAP_6LV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l6c4_equal1 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_075, VPP_ZOOM_TAP_6LV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l6c4_075 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_05, VPP_ZOOM_TAP_6LV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l6c4_05 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_033, VPP_ZOOM_TAP_6LV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l6c4_033 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_025, VPP_ZOOM_TAP_6LV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l6c4_025 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_0, VPP_ZOOM_TAP_6LV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l6c4_0 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    nSize = 192; // (4x18) / 12 * 16 + (4x18) / 12 * 16 = 192
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_1, VPP_ZOOM_TAP_4CV,  VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c4_1 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_EQU_1, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c4_equal1 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_075, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c4_075 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_05, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c4_05 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_033, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c4_033 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_025, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c4_025 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    inter_load_zoomcoef_v(VPP_ZOOM_COEF_0, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_4CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c4_0 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;

    /*4 tap for 422 */
    nSize = 192; // (4x18) / 12 * 16 + (4x18) / 12 * 16 = 192
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_1, VPP_ZOOM_TAP_4CV,  VPP_ZOOM_TAP_2CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c2_1 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;
    
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_EQU_1, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_2CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c2_equal1 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;
    
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_075, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_2CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c2_075 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;
    
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_05, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_2CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c2_05 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;
    
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_033, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_2CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c2_033 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;
    
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_025, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_2CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c2_025 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;
    
    inter_load_zoomcoef_v(VPP_ZOOM_COEF_0, VPP_ZOOM_TAP_4CV, VPP_ZOOM_TAP_2CV, pCurAddr);
    pstCoefAddr->coef_addr_tap_l4c2_0 = PhyAddr;
    PhyAddr   += nSize;
    pCurAddr += nSize;
}

static int inter_init_zoomcoef(VPP_ZOOM_COEF_ADDR_S *pstZmeModule)
{
    BUG_ON(NULL == pstZmeModule);
    
    memset((VPP_ZOOM_COEF_S *)pstZmeModule, 0, sizeof(VPP_ZOOM_COEF_S));

    pstZmeModule->StartPhyAddr = VPP_RESERVED_MEM_ADDR;
    pstZmeModule->pStartVirAddr  
            = (unsigned int*)ioremap(VPP_RESERVED_MEM_ADDR, VPP_RESERVED_BASE_SIZE);
    if (NULL == pstZmeModule->pStartVirAddr)
    {
        logi("Get zme_buf failed\n");
        return K3_FAILURE;
    }
    pstZmeModule->CoefSize = ((288 + 240 + 192 + 192) * 7);
    memset(pstZmeModule->pStartVirAddr, 0, VPP_RESERVED_BASE_SIZE);

    inter_load_zoomcoef(&(pstZmeModule->stCoefAddr), pstZmeModule->StartPhyAddr, 
                (unsigned int)pstZmeModule->pStartVirAddr);
    
    return K3_SUCCESS;
}

//去初始化ZME模块
static void inter_deinit_zoomcoef(VPP_ZOOM_COEF_ADDR_S *pstZmeModule)
{
    BUG_ON(NULL == pstZmeModule);
    
    //释放ZME_INFO缓冲区
    if (pstZmeModule->pStartVirAddr != NULL)
    {
        iounmap(pstZmeModule->pStartVirAddr);
        pstZmeModule->pStartVirAddr = NULL;
        pstZmeModule->StartPhyAddr = 0;
    }

    return;
}
//modified for zme coef config by l50053, end

//S00198515 add for DIE 20120828 [start]
static int inter_init_dieinfo(VPP_DIE_ADDR_S *pstDieModule)
{
    int i = 0;
    BUG_ON(NULL == pstDieModule);
    
    memset((VPP_DIE_ADDR_S *)pstDieModule, 0, sizeof(VPP_DIE_ADDR_S));

    pstDieModule->die_size = ( ((((DIE_FRAME_MAX_WIDTH -1) >> 6) + 1)) << 4)*DIE_FRAME_MAX_HEIGHT*10;

    pstDieModule->die_BusAddr = (unsigned int*)(s_stZoomCoef.StartPhyAddr + s_stZoomCoef.CoefSize);
    pstDieModule->die_VirtAddr 
                = (unsigned int*)((unsigned int)s_stZoomCoef.pStartVirAddr + s_stZoomCoef.CoefSize);

    memset(pstDieModule->die_VirtAddr, 0, pstDieModule->die_size);
    logd("die addr, die_BusAddr = %#x, die_VirtAddr = %#x\n"
       , (unsigned int)pstDieModule->die_BusAddr, (unsigned int)pstDieModule->die_VirtAddr);

    for(i=0; i<10; i++)
    {
        s_u32DieAddrCtrl[i] = ((unsigned int)pstDieModule->die_BusAddr) + pstDieModule->die_size/10*i;
    }
    return K3_SUCCESS;
}

static void inter_deinit_dieinfo(VPP_DIE_ADDR_S *pstDieModule)
{
    BUG_ON(NULL == pstDieModule);
    
    //释放DIE_INFO缓冲区
    return;
}
//S00198515 add for DIE 20120828 [end]

/*计算分量的地址和stride*/
static void  inter_calc_inputaddrinfo( VPP_INIMAGE_S *pInImg ,VPP_ADDRINFO_S * pVppAddrInfo)
{
    int stride = 0; 

    BUG_ON(NULL == pInImg);
    BUG_ON(NULL == pVppAddrInfo);
    BUG_ON(pInImg->pixformat >= VPP_PIXELFORMAT_BUTT);

    stride = pInImg->width; 
 
    pVppAddrInfo->vhd_lum_str = stride;
    
    switch(pInImg->pixformat)
    {
        case VPP_INPUTFMT_YCBCR_PLANAR_444:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_400:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420S:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422S:
        {
            pVppAddrInfo->vhd_chm_str = stride;
            break;
        }

        case VPP_INPUTFMT_YCBCR_PLANAR_420:
        case VPP_INPUTFMT_YCBCR_PLANAR_422:
        {
            pVppAddrInfo->vhd_chm_str = stride/2;
            break;
        }
        
        case VPP_INPUTFMT_CBYCRY_PACKAGE_422:
        case VPP_INPUTFMT_YCBYCR_PACKAGE_422:
        case VPP_INPUTFMT_YCRYCB_PACKAGE_422:
        case VPP_INPUTFMT_CRYCBY_PACKAGE_422:
        {
            if ( 0 == pInImg->stride)
	        {
	            logi("stride is zero,so we should computer the stride \n");
	            pVppAddrInfo->vhd_lum_str = 2*stride;
                pVppAddrInfo->vhd_chm_str = 2*stride;   
	        }
	        else 
	        {
	            pVppAddrInfo->vhd_lum_str = pInImg->stride;
                pVppAddrInfo->vhd_chm_str = pInImg->stride; 
            }	
           
            break;
        }
        
        default:
        {
            loge("Input pixformat is not supported, 0x%x\n", pInImg->pixformat);
            break;
        }
    }

    switch(pInImg->pixformat)
    {
        case VPP_INPUTFMT_CBYCRY_PACKAGE_422:
        case VPP_INPUTFMT_YCBYCR_PACKAGE_422:
        case VPP_INPUTFMT_YCRYCB_PACKAGE_422:
        case VPP_INPUTFMT_CRYCBY_PACKAGE_422:
        {
            pVppAddrInfo->vhd_clum_addr = pInImg->buffer_bus_addr;
            break;
        }
        
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_400:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_444:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420S:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422S:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_444S:
        {
            pVppAddrInfo->vhd_clum_addr = pInImg->buffer_bus_addr;
            pVppAddrInfo->vhd_cchm_addr = pInImg->buffer_bus_addr+pVppAddrInfo->vhd_lum_str*
                                    pInImg->height;
            break;
        }
        
        case VPP_INPUTFMT_YCBCR_PLANAR_444:
        case VPP_INPUTFMT_YCBCR_PLANAR_422:
        {
            pVppAddrInfo->vhd_clum_addr = pInImg->buffer_bus_addr;
            pVppAddrInfo->vhd_cchm_addr = pVppAddrInfo->vhd_clum_addr
                                          + pVppAddrInfo->vhd_lum_str*pInImg->height;
            pVppAddrInfo->vhd_lchm_addr = pVppAddrInfo->vhd_cchm_addr
                                          + pVppAddrInfo->vhd_chm_str*pInImg->height;
            break;
        }
        
        case VPP_INPUTFMT_YCBCR_PLANAR_420:
        {
            pVppAddrInfo->vhd_clum_addr = pInImg->buffer_bus_addr; 
            pVppAddrInfo->vhd_cchm_addr = pVppAddrInfo->vhd_clum_addr
                                          + pVppAddrInfo->vhd_lum_str*pInImg->height;
            pVppAddrInfo->vhd_lchm_addr = pVppAddrInfo->vhd_cchm_addr
                                          + pVppAddrInfo->vhd_chm_str*pInImg->height/2;
            break;
        }
        
        default:
        {
            loge("Input pixformat is not supported, 0x%x\n", pInImg->pixformat);
            BUG_ON(NULL == NULL);
            break;
        }
    }
    
    return;
}

/***********************************************************************************
* Function:       inter_set_inputaddr
* Description:   设置输入图像地址
* Data Accessed:
* Data Updated:
* Input:          HAL_LAYER_E enLayer,
*                 bool bEnable,
*                 VPP_OUTIMAGE_S vppOutImage
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:
***********************************************************************************/
static void inter_set_inputaddr(VPP_PIXELFORMAT_E pixformat, VPP_ADDRINFO_S *pVppAddrInfo,HAL_LAYER_E enLayer)
{
    BUG_ON(pixformat >= VPP_PIXELFORMAT_BUTT);
    BUG_ON(NULL == pVppAddrInfo);
    BUG_ON(enLayer != HAL_LAYER_VIDEO1);

    logd();
    
    switch(pixformat)
    {
        case  VPP_INPUTFMT_YCBCR_SEMIPLANAR_400:
        case  VPP_INPUTFMT_YCBCR_SEMIPLANAR_420:
        case  VPP_INPUTFMT_YCBCR_SEMIPLANAR_422:
        case  VPP_INPUTFMT_YCBCR_SEMIPLANAR_444:
        case  VPP_INPUTFMT_YCBCR_SEMIPLANAR_420S:
        case  VPP_INPUTFMT_YCBCR_SEMIPLANAR_422S:
        case  VPP_INPUTFMT_YCBCR_SEMIPLANAR_444S:
        case  VPP_INPUTFMT_CBYCRY_PACKAGE_422:
        case  VPP_INPUTFMT_YCBYCR_PACKAGE_422:
        case  VPP_INPUTFMT_YCRYCB_PACKAGE_422:
        case  VPP_INPUTFMT_CRYCBY_PACKAGE_422:
        {
            hal_set_layer_addr(enLayer,0,
                                  pVppAddrInfo->vhd_clum_addr,pVppAddrInfo->vhd_cchm_addr,pVppAddrInfo->vhd_lum_str, pVppAddrInfo->vhd_chm_str);
            break;
        }

        case  VPP_INPUTFMT_YCBCR_PLANAR_420:
        case  VPP_INPUTFMT_YCBCR_PLANAR_422:
        case  VPP_INPUTFMT_YCBCR_PLANAR_444:
        {
            hal_set_layer_addr(enLayer,0,
                                  pVppAddrInfo->vhd_clum_addr,pVppAddrInfo->vhd_cchm_addr,pVppAddrInfo->vhd_lum_str, pVppAddrInfo->vhd_chm_str);
            hal_set_layer_addr(enLayer,1,
                                  pVppAddrInfo->vhd_llum_addr,pVppAddrInfo->vhd_lchm_addr,pVppAddrInfo->vhd_lum_str, pVppAddrInfo->vhd_chm_str);
            break;
        }
        default:
        {
            loge("Input format is not supported, 0x%x\n", pixformat);
            BUG_ON(NULL == NULL);
            break;
        }
    }

    return;
}

//根据窗口偏移量，计算内存中图像显示起始地址相对基地址的偏移量
//当格式为非SEMIPLANAR格式时，参数bLuma无效
static unsigned int inter_calc_addrdiff(VPP_PIXELFORMAT_E enFormat, unsigned int X, unsigned int Y, unsigned int Stride, 
    bool bLuma)
{
    unsigned int AddrDiff = 0;

    BUG_ON(enFormat >= VPP_PIXELFORMAT_BUTT);

    logd();

    switch(enFormat)
    {
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420:
        {
            //计算真正的地址偏移
            if (true == bLuma)
            {
                AddrDiff = X + (Stride * Y);
            }
            else
            {
                AddrDiff = X + (Stride * Y / 2);
            }
            break;
        }
        
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422:
        {
            //计算真正的地址偏移
            if (true == bLuma)
            {
                AddrDiff = X + (Stride * Y);
            }
            else
            {
                AddrDiff = (X * 2) + (Stride * Y);
            }
            break;
        }
        
        case VPP_INPUTFMT_CBYCRY_PACKAGE_422:
        case VPP_INPUTFMT_YCBYCR_PACKAGE_422:
        case VPP_INPUTFMT_YCRYCB_PACKAGE_422:
        case VPP_INPUTFMT_CRYCBY_PACKAGE_422:
        {
            //计算真正的地址偏移
            AddrDiff = (X * 2) + (Stride * Y);
            break;
        }
        //TODO
        default:
        {
            AddrDiff = 0;
            break;
        }
    }

    return AddrDiff;
}

/***********************************************************************************
* Function:       inter_set_wbcconfig
* Description:   设置输出图像的信息
* Data Accessed:
* Data Updated:
* Input:          HAL_LAYER_E enLayer,
*                 bool bEnable,
*                 VPP_OUTIMAGE_S vppOutImage
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:
***********************************************************************************/
static void inter_set_wbcconfig(HAL_LAYER_E enLayer, bool bEnable, VPP_OUTIMAGE_S *pVppOutImage)
{
    BUG_ON(NULL == pVppOutImage);
    BUG_ON(HAL_LAYER_WBC1 != enLayer);

    logd();

    /*enable wbc1*/
    hal_set_wbc_enable(enLayer, bEnable);

    /*set wbc busaddr*/
    hal_set_wbc_addr(enLayer, pVppOutImage->buffer_bus_addr);

    /*set wbc1 stride*/
    hal_set_wbc_stride(enLayer, pVppOutImage->stride);

    /*set wbc1 mode, only surport off line*/
    hal_set_wbc_md(HAL_WBC_RESOSEL_OFL); 

    hal_set_wbc_wr_mode( enLayer, 0);

    /*set wbc1 pixformat*/
    hal_set_wbc_out_fmt(enLayer, pVppOutImage->pixformat);  

}

static int inter_get_frame_stride( VPP_PIXELFORMAT_E  pixformat )
{
    int framestride = 0;

    switch(pixformat)
    {
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_400:
        {
            framestride = 1;
            break;
        }
        case VPP_INPUTFMT_YCBCR_PLANAR_444    :
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_444:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_444S:
        {
            framestride = 3;
            break;
        }
        case VPP_INPUTFMT_YCBCR_PLANAR_420    :
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420S:
        {
            framestride = 3/2;
            break;
        }
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422S:
        case VPP_INPUTFMT_YCBCR_PLANAR_422    :
        case VPP_INPUTFMT_CBYCRY_PACKAGE_422  :
        case VPP_INPUTFMT_YCBYCR_PACKAGE_422  :
        case VPP_INPUTFMT_YCRYCB_PACKAGE_422  :
        case VPP_INPUTFMT_CRYCBY_PACKAGE_422  :
        {
            framestride = 2;
            break;
        }
        default:
        {
            loge("\n Err: Input pixformat is not supported\n\n");
            return K3_FAILURE;
        }
    }
    return framestride;
}

static int inter_check_para( VPP_CONFIG_S *pVppConf, VPP_ADDRINFO_S *pVppAddrInfo)
{
    BUG_ON(NULL == pVppConf);
    BUG_ON( NULL == pVppAddrInfo);

    VPP_INIMAGE_S *pInImg = NULL;
    VPP_OUTIMAGE_S *pOutImg = NULL;
    VPP_INCROPPING_S *pInCrop = NULL;
    VPP_DIE_ADDRINFO_S *pDieAddr = NULL;
    bool bdie_enb = false;
    int frameStride = 0;

    pInImg = &(pVppConf->vpp_in_img);
    pOutImg = &(pVppConf->vpp_out_img);
    pInCrop = &(pVppConf->vpp_in_crop);
    pDieAddr = &(pVppConf->vpp_die_addrinfo);
    bdie_enb = pVppConf->bdie_enbale;

    if((pInImg->width > VPP_IRECT_MAX_W) || ( pInImg->height > VPP_IRECT_MAX_H)
       || (pInImg->width < VPP_IRECT_MIN_W) || (pInImg->height < VPP_IRECT_MIN_H))
    {
        loge("input width/height is invalid(width:64~4096, height:64~4096): w = %d, h= %d\n",
                        pInImg->width, pInImg->height);
        return K3_FAILURE;
    }
    
    if((pOutImg->width * pOutImg->height > VPP_ORECT_MAX_H * VPP_ORECT_MAX_W)
        || (pOutImg->width < VPP_ORECT_MIN_W) || (pOutImg->height < VPP_ORECT_MIN_H))
    {
        loge("output width/height is invalid(width:64~1920, height:64~1080): w = %d, h= %d\n",
                        pOutImg->width, pOutImg->height);
        return K3_FAILURE;
    }

    if(((pInImg->height*VPP_IRECT_MAX_H/pOutImg->height) >= VPP_IRECT_MAX_H*VPP_MAX_RATIO)
        || ((pInImg->height*VPP_IRECT_MAX_H/pOutImg->height) < VPP_IRECT_MAX_H*VPP_MIN_RARIO))
    {
        loge("height ratio is invalid(1/16~16): input h = %d, output h = %d\n",
                      pInImg->height, pOutImg->height);
        return K3_FAILURE;
    }

    if(((pInImg->width*VPP_IRECT_MAX_W/pOutImg->width) >= VPP_IRECT_MAX_W*VPP_MAX_RATIO)
        || ((pInImg->width*VPP_IRECT_MAX_W/pOutImg->width) < VPP_IRECT_MAX_W*VPP_MIN_RARIO))
    {
        loge("width ratio is invalid(1/16~16): input w = %d, output w = %d\n",
                     pInImg->width, pOutImg->width);
        return K3_FAILURE;
    }

    if(k3_true == bdie_enb)
    {
        if((0 == pDieAddr->lluma_addr) || (0 == pDieAddr->lchroma_addr)
            || (0 == pDieAddr->cluma_addr) || (0 == pDieAddr->cchroma_addr)
            || (0 == pDieAddr->nluma_addr) || (0 == pDieAddr->nchroma_addr))
        {
            loge("die address is invalid(=0):lluma_addr = %d, lchroma_addr = %d, cluma_addr = %d, cchroma_addr = %d, nluma_addr = %d, nchroma_addr = %d\n",
                     pDieAddr->lluma_addr, pDieAddr->lchroma_addr, pDieAddr->cluma_addr, pDieAddr->cchroma_addr, pDieAddr->nluma_addr, pDieAddr->nchroma_addr);
            return K3_FAILURE;
        }
    }

    /*数据格式相关检测*/
    switch(pInImg->pixformat)
    {
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_400:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_444:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_420S:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_422S:
        case VPP_INPUTFMT_YCBCR_SEMIPLANAR_444S:
        {
            if(0 == pVppAddrInfo->vhd_clum_addr )
            {
                loge("SEMIPALNAR dataformat not config Y addr");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_cchm_addr )
            {
                loge("SEMIPALNAR dataformat not config C addr");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_lum_str )    
            {
                loge("SEMIPALNAR dataformat not config Y stride");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_chm_str )  
            {
                loge("SEMIPALNAR dataformat not config C stride");
                return K3_FAILURE;
            }

            if( pInImg->width%2 != 0 )
            {
                loge("Input width must 2X, width = %d\n",pInImg->width);
                return K3_FAILURE;
            }

            if( pInImg->height%4 != 0 )
            {
                loge("Input height must 4X, height = %d\n", pInImg->height);
                return K3_FAILURE;
            }

            break;
        }
        case VPP_INPUTFMT_YCBCR_PLANAR_420:
        case VPP_INPUTFMT_YCBCR_PLANAR_422:
        case VPP_INPUTFMT_YCBCR_PLANAR_444:
        {
            if( 0 == pVppAddrInfo->vhd_clum_addr )
            {
                loge("PALNAR dataformat not config Y addr");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_cchm_addr )
            {
                loge("PALNAR dataformat not config U addr");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_lchm_addr )
            {
                loge("PALNAR dataformat not config V addr");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_lum_str )
            {
                loge("PALNAR dataformat not config Y stride");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_chm_str ) 
            {
                loge("PALNAR dataformat not config C stride");
                return K3_FAILURE;
            }

            if( pInImg->width%8 != 0 )
            {
                loge("Input width must 4X, width = %d\n", pInImg->width);
                return K3_FAILURE;
            }

            if( pInImg->height%4 != 0 )
            {
                loge("Input height must 4X, height = %d\n", pInImg->height);
                return K3_FAILURE;
            }

            break;
        }
        case VPP_INPUTFMT_CBYCRY_PACKAGE_422:
        case VPP_INPUTFMT_YCBYCR_PACKAGE_422:
        case VPP_INPUTFMT_YCRYCB_PACKAGE_422:
        case VPP_INPUTFMT_CRYCBY_PACKAGE_422:
        {
            if( 0 == pVppAddrInfo->vhd_clum_addr )
            {
                loge("PACKAGE dataformat not config addr");
                return K3_FAILURE;
            }

            if( 0 == pVppAddrInfo->vhd_lum_str )
            {
                loge("PACKAGE dataformat not config stride");
                return K3_FAILURE;
            }

            if( pInImg->width%4 != 0 )
            {
                loge("Input width must 4X, width = %d\n", pInImg->width);
                return K3_FAILURE;
            }

            if( pInImg->height%4 != 0 )
            {
                loge("Input height must 4X, height = %d\n", pInImg->height);
                return K3_FAILURE;
            }

            break;
        }
        default:
        {
            loge("Input format is not supported, 0x%x\n", pInImg->pixformat);
            return K3_FAILURE;
        }
    }

	if(pOutImg->pixformat >= VPP_INTFDATAFMT_BUTT)
	{
		loge("output img format is invalid, 0x%x\n", pOutImg->pixformat);
		return K3_FAILURE;
	}

	/*输出图像宽高对齐*/
	if ( (pOutImg->width%4 != 0) || (pOutImg->height%4 != 0) )
	{
		loge("output width or height must 4X width = %d, height = %d\n",
		pOutImg->width,pOutImg->height);
		return K3_FAILURE;
	}

	if (pInImg->buffer_bus_addr %4 != 0 || pOutImg->buffer_bus_addr %4 != 0)
	{
		loge("addr must 4X out address = %#X,in address = %#X\n",
		(unsigned int )pOutImg->buffer_bus_addr, (unsigned int)pInImg->buffer_bus_addr);
		return K3_FAILURE;
	}

	/*crop*/
	if ((pInCrop->cropX + pInCrop->width > pInImg->width)
			|| (pInCrop->cropY + pInCrop->height) > pInImg->height)
	{
		loge("crop is error out cropX = %d,cropY = %d,width = %d,height = %d\n",
		pInCrop->cropX, pInCrop->cropY,pInCrop->width,pInCrop->height);
		return K3_FAILURE;
	}

	/*stride*/
	frameStride = inter_get_frame_stride( pInImg->pixformat);
	if (frameStride <= 0)
	{
		loge("get stride is error ,frameStride = %d\n",frameStride);
		return K3_FAILURE;
	}

	if ((pInImg->stride < pInImg->width*frameStride) ||(pInImg->stride % 16 != 0))
	{
		loge("input stride is error , stride must 16X stride = %d,realstride = %d\n",
		pInImg->stride, pInImg->width*frameStride);
		return K3_FAILURE;
	}

	if ((pOutImg->stride < pOutImg->width*2) || (pOutImg->stride %16 != 0))
	{
		loge("output stride is error ,stride must 16X stride = %d\n",pOutImg->stride);
		return K3_FAILURE;
	}
    
    return K3_SUCCESS;
}

/***********************************************************************************
* Function:       inter_set_cscconfig
* Description:   设置CSC功能
* Data Accessed:
* Data Updated:
* Input:          HAL_LAYER_E enLayer,
*                 bool bEnable,
*                 VPP_OUTIMAGE_S vppOutImage
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:
***********************************************************************************/

static void inter_set_cscconfig(HAL_LAYER_E enLayer,VPP_CSCCOEF_E cscMode, bool bEnable)
{
    HAL_CSCCOEF_S Coef;
    memset(&Coef, 0, sizeof(HAL_CSCCOEF_S));

    BUG_ON(cscMode >= VPP_CSC_BUTT );
    BUG_ON( HAL_LAYER_VIDEO1 != enLayer);

    logd("bEnable = %d\n",bEnable);
    
    hal_set_layer_csc(enLayer, bEnable);
    
    if( VPP_CSC_YUV2YUV_709_601 == cscMode )
    {
        Coef.csc_coef00  = (int)(     1*256);
        Coef.csc_coef01  = (int)(-0.116*256);
        Coef.csc_coef02  = (int)( 0.208*256);

        Coef.csc_coef10  = (int)(     0*256);
        Coef.csc_coef11  = (int)( 1.017*256);
        Coef.csc_coef12  = (int)( 0.114*256);

        Coef.csc_coef20  = (int)(     0*256);
        Coef.csc_coef21  = (int)( 0.075*256);
        Coef.csc_coef22  = (int)( 1.025*256);

        Coef.csc_in_dc2  = -16;
        Coef.csc_in_dc1  = -128;
        Coef.csc_in_dc0  = -128;

        Coef.csc_out_dc2 =   16;
        Coef.csc_out_dc1 =  128;
        Coef.csc_out_dc0 =  128;
    }
    else if( VPP_CSC_YUV2YUV_601_709 == cscMode )
    {
        Coef.csc_coef00  = (int)(     1*256);
        Coef.csc_coef01  = (int)(-0.116*256);
        Coef.csc_coef02  = (int)( 0.208*256);

        Coef.csc_coef10  = (int)(     0*256);
        Coef.csc_coef11  = (int)( 1.017*256);
        Coef.csc_coef12  = (int)( 0.114*256);

        Coef.csc_coef20  = (int)(     0*256);
        Coef.csc_coef21  = (int)( 0.075*256);
        Coef.csc_coef22  = (int)( 1.025*256);

        Coef.csc_in_dc2  = -16;
        Coef.csc_in_dc1  = -128;
        Coef.csc_in_dc0  = -128;

        Coef.csc_out_dc2 =   16;
        Coef.csc_out_dc1 =  128;
        Coef.csc_out_dc0 =  128;
    }
    else
    {
        Coef.csc_coef00  = 1*256;
        Coef.csc_coef01  = 0*256;
        Coef.csc_coef02  = 0*256;

        Coef.csc_coef10  = 0*256;
        Coef.csc_coef11  = 1*256;
        Coef.csc_coef12  = 0*256;

        Coef.csc_coef20  = 0*256;
        Coef.csc_coef21  = 0*256;
        Coef.csc_coef22  = 1*256;

        Coef.csc_in_dc2  = -16;
        Coef.csc_in_dc1  = -128;
        Coef.csc_in_dc0  = -128;

        Coef.csc_out_dc2 =  16;
        Coef.csc_out_dc1 = 128;
        Coef.csc_out_dc0 = 128;
    }

    if ( true == bEnable )
    {
        hal_set_intf_csc_coef( enLayer, Coef);
    }
}

/***********************************************************************************
* Function:       inter_init
* Description:   初始化VPP模块，支持重复打开
* Data Accessed:
* Data Updated:
* Input:          NA
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:
***********************************************************************************/
int inter_init(void)
{
    logd("enter inter Inited!\n");

    //创建公共组件
    //创建ZME系数表
    if (inter_init_zoomcoef(&s_stZoomCoef) != K3_SUCCESS)
    {
        loge("VPP malloc zme coef buf failed.\n");
        return K3_FAILURE;
    }

    if (inter_init_dieinfo(&s_stDieAddr) != K3_SUCCESS)
    {
        loge("VPP malloc die buf failed.\n");
        return K3_FAILURE;
    }
    //hal_init();

    return K3_SUCCESS;
}

/***********************************************************************************
* Function:       inter_deinit
* Description:   去初始化VPP模块，支持重复去初始化
* Data Accessed:
* Data Updated:
* Input:          NA
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:
***********************************************************************************/
void inter_deinit(void)
{
    logd("enter deinit\n");

    //hal_deinit();
    //释放ZME系数表
    inter_deinit_zoomcoef(&s_stZoomCoef);

    inter_deinit_dieinfo(&s_stDieAddr);

    return;
}

/***********************************************************************************
* Function:      inter_open
* Description:   关闭视频层
* Data Accessed:
* Data Updated:
* Input:         enVo --视频层ID
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:        
***********************************************************************************/
void inter_open(HAL_LAYER_E enLayer)
{
    VPP_VPP_S  *pstVpp = NULL;

    logd("enter open enLayer = %d!\n",enLayer);
    
    VPP_GET_HANDLE(enLayer, pstVpp);

    pstVpp->bopened = true;
    
    return;
}

/***********************************************************************************
* Function:      inter_close
* Description:    关闭视频层
* Data Accessed:
* Data Updated:
* Input:         enVo --视频层ID
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:        
**********************************************************************************/
void inter_close(HAL_LAYER_E enLayer)
{
    VPP_VPP_S     *pstVpp = NULL;
    logd("enter close enLayer = %d!\n",enLayer);

    //获取VPP句柄
    VPP_GET_HANDLE(enLayer, pstVpp);

    if (pstVpp->bopened != true)
    {
        logi("the device isn't open\n");
        return;
    }

    /*close video1 layer*/
    hal_enable_layer(enLayer, false);

    pstVpp->bopened = false;

    return;
}

//add for zme coef config by l50053, begin
static unsigned int inter_get_hfir_coef(HAL_FIR_COEF_ADDR_S *p_coef_addr, int lum_hfir_ratio)
{
    unsigned int coef;
    int ratio = 4096 * 4096 / lum_hfir_ratio;

    if (ratio > 4096)
    {
        coef = p_coef_addr->coef_addr_tap_l8c4_1;
    }
    else if (ratio == 4096)
    {
        coef = p_coef_addr->coef_addr_tap_l8c4_equal1;
    }
    else if (ratio >= 3072)
    {
        coef = p_coef_addr->coef_addr_tap_l8c4_075;
    }
    else if (ratio >= 2048)
    {
        coef = p_coef_addr->coef_addr_tap_l8c4_05;
    }
    else if (ratio >= 1365)
    {
        coef = p_coef_addr->coef_addr_tap_l8c4_033;
    }
    else if (ratio >= 1024)
    {
        coef = p_coef_addr->coef_addr_tap_l8c4_025;
    }
    else
    {
        coef = p_coef_addr->coef_addr_tap_l8c4_0;
    }

    return coef;
}

static unsigned int inter_get_vfir_coef(HAL_FIR_COEF_ADDR_S *p_coef_addr, int lum_vfir_ratio, VPP_ALG_FLT_TAP_E lum_vfir_tap, VPP_ALG_FLT_TAP_E chm_vfir_tap)
{
    unsigned int coef;
    int ratio = 4096 * 4096 / lum_vfir_ratio;

	if(TAP6 == lum_vfir_tap && TAP4 == chm_vfir_tap)  // L6C4
	{
	      if(ratio > 4096)       coef = p_coef_addr->coef_addr_tap_l6c4_1   ;
            else if(ratio == 4096) coef = p_coef_addr->coef_addr_tap_l6c4_equal1 ;
            else if(ratio >= 3072) coef = p_coef_addr->coef_addr_tap_l6c4_075 ;
            else if(ratio >= 2048) coef = p_coef_addr->coef_addr_tap_l6c4_05  ;
            else if(ratio >= 1365) coef = p_coef_addr->coef_addr_tap_l6c4_033 ;
            else if(ratio >= 1024) coef = p_coef_addr->coef_addr_tap_l6c4_025 ;
            else                   coef = p_coef_addr->coef_addr_tap_l6c4_0   ;
	}
	else if(TAP4 == lum_vfir_tap && TAP4 == chm_vfir_tap)  // L4C4
	{
            if(ratio > 4096)       coef = p_coef_addr->coef_addr_tap_l4c4_1   ;
            else if(ratio == 4096) coef = p_coef_addr->coef_addr_tap_l4c4_equal1 ;
            else if(ratio >= 3072) coef = p_coef_addr->coef_addr_tap_l4c4_075 ;
            else if(ratio >= 2048) coef = p_coef_addr->coef_addr_tap_l4c4_05  ;
            else if(ratio >= 1365) coef = p_coef_addr->coef_addr_tap_l4c4_033 ;
            else if(ratio >= 1024) coef = p_coef_addr->coef_addr_tap_l4c4_025 ;
            else                   coef = p_coef_addr->coef_addr_tap_l4c4_0   ;
    }
	else// L4C2
    {
            if(ratio > 4096)       coef = p_coef_addr->coef_addr_tap_l4c2_1;
            else if(ratio == 4096) coef = p_coef_addr->coef_addr_tap_l4c2_equal1;
            else if(ratio >= 3072) coef = p_coef_addr->coef_addr_tap_l4c2_075;
            else if(ratio >= 2048) coef = p_coef_addr->coef_addr_tap_l4c2_05;
            else if(ratio >= 1365) coef = p_coef_addr->coef_addr_tap_l4c2_033;
            else if(ratio >= 1024) coef = p_coef_addr->coef_addr_tap_l4c2_025;
            else                   coef = p_coef_addr->coef_addr_tap_l4c2_0;
	}

	return coef;
}

static VPP_SCALER_INFO inter_get_scaler_info(VPP_INIMAGE_S  *pInImage, VPP_OUTIMAGE_S *pOutImage, HAL_FIR_COEF_ADDR_S *pCoefAddr
                  , VPP_ALG_FLT_TAP_E lum_vfir_tap, VPP_ALG_FLT_TAP_E chm_vfir_tap, int flag)
{
    VPP_SCALER_INFO scaler_info = {0};
    int chm_vfir_ratio = 0, chm_hfir_ratio = 0;
    int voffset = 0, hoffset = 0;

    //add by z39183
    HAL_FIR_COEF_ADDR_S *p_coef_addr = pCoefAddr;

    scaler_info.hfir_order = 0; //horizontal scaler after vertical scaler

    scaler_info.lum_hfir_en = 1;
    scaler_info.lum_vfir_en = 1;
    scaler_info.chm_hfir_en = 1;
    scaler_info.chm_vfir_en = 1;
    //get lum filter ratio
    scaler_info.lum_hfir_ratio = pInImage->width * 4096 / pOutImage->width;
    scaler_info.lum_vfir_ratio = pInImage->height* 4096 / pOutImage->height;

    //get chroma filter ratio
    chm_hfir_ratio = scaler_info.lum_hfir_ratio;
    chm_vfir_ratio = scaler_info.lum_vfir_ratio >> 1;

    //get lum/chroma filter mode
    if (4096 == scaler_info.lum_hfir_ratio)   //when 1:1 horizontal scaler, directly copy
    {
        scaler_info.lum_hfir_mode = 0;
        scaler_info.chm_hfir_mode = 0;
    }
    else
    {
        scaler_info.lum_hfir_mode = 1;
        scaler_info.chm_hfir_mode = 1;
    }

    //get lum/chroma filter mode
    if(4096 == scaler_info.lum_vfir_ratio)//when 1:1 vertical scaler, directly copy
    {
        scaler_info.lum_vfir_mode = 0;
    }
    else
    {
        scaler_info.lum_vfir_mode = 1;
     }
               
     if(4096 == chm_vfir_ratio)//when 1:1 vertical scaler, directly copy
     {
        scaler_info.chm_vfir_mode = 0;
     }
     else
     {
        scaler_info.chm_vfir_mode = 1;
     }

    if(0 == flag)
    {
        if(TAP6 == lum_vfir_tap)
        {
            scaler_info.lum_vfir_tap = 0;
        }
        else
        {
            scaler_info.lum_vfir_tap = 1;//0-6tap; 1-4tap;
        }
    }
    else
    {
        if(TAP4 == lum_vfir_tap)
        {
            scaler_info.lum_vfir_tap = 0;
        }
        else
        {
            scaler_info.lum_vfir_tap = 1;//0-4tap; 1-2tap;
        }
    }
    if(TAP4 == chm_vfir_tap)
    {
    	scaler_info.chm_vfir_tap = 0; 
    }
    else
    {
    	scaler_info.chm_vfir_tap = 1; //0-4tap; 1-2tap;
    }

    //get median filter status for lum and chroma scaler: if filter tap > 2 and upscaler, median filter enable
    if (scaler_info.lum_hfir_ratio < 4096)
    {
        scaler_info.lum_hmed_en = 1;
    }
    else
    {
        scaler_info.lum_hmed_en = 0;
    }

    if (scaler_info.lum_vfir_ratio < 4096)
    {
        scaler_info.lum_vmed_en = 1;
    }
    else
    {
        scaler_info.lum_vmed_en = 0;
    }

    if (chm_hfir_ratio < 4096)
    {
        scaler_info.chm_hmed_en = 1;
    }
    else
    {
        scaler_info.chm_hmed_en = 0;
    }

    if (0 == scaler_info.chm_vfir_tap) //4 tap
    {
        if (chm_vfir_ratio < 4096)
        {
            scaler_info.chm_vmed_en = 1;
        }
        else
        {
            scaler_info.chm_vmed_en = 0;
        }
    }
    else //2 tap
    {
        scaler_info.chm_vmed_en = 0;
    }

    scaler_info.coef_addr_h 
                = inter_get_hfir_coef(p_coef_addr, scaler_info.lum_hfir_ratio);
    scaler_info.coef_addr_v 
                = inter_get_vfir_coef(p_coef_addr, scaler_info.lum_vfir_ratio, lum_vfir_tap, chm_vfir_tap);

    //get horizontal and vertical offset for lums
    scaler_info.lum_hor_offset = 0;
    scaler_info.lum_ver_offset = 0;

    //get horizontal and vertical offset for chroma
    voffset = 0, hoffset = 0;
    scaler_info.chm_hor_offset = 0;
    scaler_info.chm_ver_offset = 0;

    return scaler_info;
}
//add for zme coef config by l50053, end

/***********************************************************************************
* Function:      inter_start
* Description:   启动配置VPP
* Data Accessed:
* Data Updated:
* Input:        vppConfig 输入VPP配置参数
* Output:        
* Return:        K3_SUCCESS/errorcode
* Others:
***********************************************************************************/
int inter_start(VPP_CONFIG_S* pVppConfig)
{
    VPP_INIMAGE_S  *pInImage = NULL;
    VPP_OUTIMAGE_S *pOutImage = NULL;
    VPP_INCROPPING_S *pInCrop = NULL;
    VPP_ADDRINFO_S addrInfo = {0};
    VPP_SCALER_INFO scalerInfo = {0}; //add for zme coef config by l50053
    
    HAL_RECT_S vhdrect = {0};
    //static int bTop = 1;

    unsigned int u32YAddrDiff = 0;
    unsigned int u32CAddrDiff = 0;

    logd("enter inter start \n");
    BUG_ON(NULL == pVppConfig);
    
    pInImage = &(pVppConfig->vpp_in_img);
    pOutImage = &(pVppConfig->vpp_out_img);
    pInCrop = &(pVppConfig->vpp_in_crop);
    
    logd("enter start pixformat = %d\n", pInImage->pixformat);

    vhdrect.s32DXL = pOutImage->width;   /*显示列结束坐标, 以帧高度为参考，以行为单位*/
    vhdrect.s32DYL = pOutImage->height;
    vhdrect.u32InWidth   = pInImage->width;
    vhdrect.u32InHeight  = pInImage->height;
    vhdrect.u32OutWidth  = pOutImage->width;
    vhdrect.u32OutHeight = pOutImage->height;

    inter_calc_inputaddrinfo(pInImage, &addrInfo);
    if (K3_SUCCESS != inter_check_para( pVppConfig, &addrInfo))
    {
        loge("inter_check_para fail\n");
        return K3_FAILURE;
    }

    //add for zme coef config by l50053
    scalerInfo = inter_get_scaler_info(pInImage, pOutImage, &(s_stZoomCoef.stCoefAddr), TAP6, TAP4, 0); 
    
    hal_enable_layer(HAL_LAYER_VIDEO1, true);
    hal_set_layer_data_fmt( HAL_LAYER_VIDEO1, pInImage->pixformat);
    hal_set_layer_rect(HAL_LAYER_VIDEO1,vhdrect );
    if ( true == pVppConfig->bincrop_enable )
    {
        logi("crop enable\n");
        vhdrect.u32InWidth   = pInCrop->width;
        vhdrect.u32InHeight  = pInCrop->height;
        u32YAddrDiff = inter_calc_addrdiff(pInImage->pixformat, pInCrop->cropX, pInCrop->cropY, 
                   addrInfo.vhd_lum_str, true);
        u32CAddrDiff = inter_calc_addrdiff(pInImage->pixformat, pInCrop->cropX, pInCrop->cropY, 
                   addrInfo.vhd_lum_str, false);
    }

    inter_set_inputaddr(pInImage->pixformat, &addrInfo, HAL_LAYER_VIDEO1);
    //S00198515 add for DIE enable 20120828 [start]
    addrInfo.lluma_addr = pVppConfig->vpp_die_addrinfo.lluma_addr;
    addrInfo.lchroma_addr = pVppConfig->vpp_die_addrinfo.lchroma_addr;
    addrInfo.cluma_addr = pVppConfig->vpp_die_addrinfo.cluma_addr;
    addrInfo.cchroma_addr = pVppConfig->vpp_die_addrinfo.cchroma_addr;
    addrInfo.nluma_addr = pVppConfig->vpp_die_addrinfo.nluma_addr;
    addrInfo.nchroma_addr = pVppConfig->vpp_die_addrinfo.nchroma_addr;
    //S00198515 add for DIE enable 20120828 [end]
    
    hal_set_zme_reso(HAL_LAYER_VIDEO1, vhdrect );

    hal_set_read_mode(HAL_LAYER_VIDEO1, HAL_PROGRESSIVE, HAL_PROGRESSIVE);

    inter_set_wbcconfig(HAL_LAYER_WBC1, true, pOutImage);

    //modified for zme coef config by l50053, begin
    // DUT ZME cfg.
    hal_set_zme_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORL, (unsigned int)(scalerInfo.lum_hfir_en));
    hal_set_zme_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERL, (unsigned int)(scalerInfo.lum_vfir_en));
    hal_set_zme_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORC, (unsigned int)(scalerInfo.chm_hfir_en));
    hal_set_zme_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERC, (unsigned int)(scalerInfo.chm_vfir_en));


    hal_set_zme_fir_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORL, (unsigned int)(scalerInfo.lum_hfir_mode));
    hal_set_zme_fir_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERL, (unsigned int)(scalerInfo.lum_vfir_mode));
    hal_set_zme_fir_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORC, (unsigned int)(scalerInfo.chm_hfir_mode));
    hal_set_zme_fir_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERC, (unsigned int)(scalerInfo.chm_vfir_mode));
    
    hal_set_mid_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORL, (unsigned int)(scalerInfo.lum_hmed_en));
    hal_set_mid_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERL, (unsigned int)(scalerInfo.lum_vmed_en));
    hal_set_mid_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORC, (unsigned int)(scalerInfo.chm_hmed_en));
    hal_set_mid_enable(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERC, (unsigned int)(scalerInfo.chm_vmed_en));

    if (scalerInfo.lum_hfir_ratio > 4096)
    {
        hal_set_hfir_order(HAL_LAYER_VIDEO1, 0);
    }
    else
    {
        hal_set_hfir_order(HAL_LAYER_VIDEO1, 1);
    }

    hal_set_zme_vertap(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERL, scalerInfo.lum_vfir_tap);
    hal_set_zme_vertap(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERC, scalerInfo.chm_vfir_tap);
    hal_set_zme_ver_type(HAL_LAYER_VIDEO1, 1);

    hal_set_hor_ratio(HAL_LAYER_VIDEO1, scalerInfo.lum_hfir_ratio);
    hal_set_ver_ratio(HAL_LAYER_VIDEO1, scalerInfo.lum_vfir_ratio);

  
    hal_set_zme_phase(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORL, scalerInfo.lum_hor_offset);
    hal_set_zme_phase(HAL_LAYER_VIDEO1, HAL_ZMEMODE_HORC, scalerInfo.chm_hor_offset);
    hal_set_zme_phase(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERL, scalerInfo.lum_ver_offset);
    hal_set_zme_phase(HAL_LAYER_VIDEO1, HAL_ZMEMODE_VERC, scalerInfo.chm_ver_offset);;

    //--------------------------coef update----------------------------//
    // when api use it, need to change to addr cfg.
    hal_set_coef_addr(HAL_LAYER_VIDEO1, HAL_COEFMODE_HOR, scalerInfo.coef_addr_h);
    hal_set_coef_addr(HAL_LAYER_VIDEO1, HAL_COEFMODE_VER, scalerInfo.coef_addr_v);

    // must cfg coef update && the coef addr must before it.
    hal_set_layer_para_upd(HAL_LAYER_VIDEO1, HAL_COEFMODE_HOR);
    hal_set_layer_para_upd(HAL_LAYER_VIDEO1, HAL_COEFMODE_VER);


    inter_set_cscconfig(HAL_LAYER_VIDEO1,pVppConfig->encsc_mode, pVppConfig->bcsc_enable);
    //modified for zme coef config by l50053, end

    //S00198515 add for DIE enable 20120828 [start]
    if(1 == pVppConfig->bdie_enbale)
    {
        logi("Die Type Mode Enable!\n");
	
        hal_set_die_enable      (HAL_LAYER_VIDEO1, 1,1);
        hal_set_die_chm_mode  (HAL_LAYER_VIDEO1, VPP_DIE_MODE_3FIELD);
        hal_set_die_luma_mode(HAL_LAYER_VIDEO1, VPP_DIE_MODE_3FIELD);

        hal_set_die_stp_rst      (HAL_LAYER_VIDEO1, 0);
        hal_set_die_outsel      (HAL_LAYER_VIDEO1, 0);
        hal_set_die_stp_update   (HAL_LAYER_VIDEO1, 1);

        hal_set_die_st_mode(HAL_LAYER_VIDEO1, VPP_DIE_STMD_KLM);

        //die stream order, 0:TBTB,1:BTBT
		hal_set_field_order(HAL_LAYER_VIDEO1, VPP_T_FIRST);//S00198515 modify 20120904
		/*if(bTop == 1)
		{
            hal_set_field_order(HAL_LAYER_VIDEO1, VPP_T_FIRST);
			bTop = 0;
		}
		else
		{
            hal_set_field_order(HAL_LAYER_VIDEO1, VPP_B_FIRST);
			bTop = 1;
		}*/

        hal_set_layer_addr(HAL_LAYER_VIDEO1, 0, addrInfo.cluma_addr, addrInfo.cchroma_addr, addrInfo.vhd_lum_str, addrInfo.vhd_chm_str);
        hal_set_layer_addr(HAL_LAYER_VIDEO1, 1, addrInfo.lluma_addr, addrInfo.lchroma_addr, addrInfo.vhd_lum_str, addrInfo.vhd_chm_str);
        hal_set_layer_addr(HAL_LAYER_VIDEO1, 2, addrInfo.nluma_addr, addrInfo.nchroma_addr, addrInfo.vhd_lum_str, addrInfo.vhd_chm_str);


        hal_set_die_addr(HAL_LAYER_VIDEO1, VPP_DIE_STMD_KLM, s_u32DieAddrCtrl, 0);

        hal_set_read_mode(HAL_LAYER_VIDEO1, HAL_BOTTOM, HAL_BOTTOM);//S00198515 modify 20120904
        /*if(bTop == 1)
        {
            hal_set_read_mode(HAL_LAYER_VIDEO1, HAL_TOP, HAL_TOP);
	        bTop = 0;
        }
        else
        {
            hal_set_read_mode(HAL_LAYER_VIDEO1, HAL_BOTTOM, HAL_BOTTOM);
	        bTop = 1;
        }*/
	} 
    //S00198515 add for DIE enable 20120828 [end]

    hal_set_regup(HAL_LAYER_VIDEO1);
    
    return K3_SUCCESS;
}


